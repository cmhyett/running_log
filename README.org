# TODO plot pace on graph
# TODO fix effort calculation
# TODO allow easy aggregation of week/month/year data

[[./imgs/jan1.png]]

#+PLOT: set:"term 
pngcairo size 500,300" title:"Mileage" ind:1 deps:(2) type:2d with:histograms set:"yrange [0:8]" set:"xrange[-0.5:7.5]" file:"./imgs/jan1.png"
| Date       | Mileage | Elevation gain | Time       | Effort |  Pace | Grade (%) | Surface        | Avg Hr | Elevation (ft) |
|------------+---------+----------------+------------+--------+-------+-----------+----------------+--------+----------------|
| 1/1        |     3.0 |            237 | 0@ 32' 22" |      6 | 10.79 |      2.99 | Trail          |    162 |           7300 |
| 1/2        |     2.0 |            136 | 0@ 18' 33" |      4 |  9.28 |      2.58 | Pavement       |    152 |           7300 |
| 1/3        |         |                |            |        |  0.00 |      0.00 |                |        |                |
| 1/4        |     5.0 |            492 | 0@ 53' 47" |      4 | 10.76 |      3.73 | Trail          |    159 |           7100 |
| 1/5        |     3.0 |            132 | 0@ 29' 14" |      3 |  9.74 |      1.67 | Pavement       |    145 |           7300 |
| 1/6        |         |                |            |        |  0.00 |      0.00 |                |        |                |
| 1/7        |     5.0 |            270 | 0@ 49' 31" |      3 |  9.90 |      2.05 | Pavement, snow |    143 |           7300 |
|------------+---------+----------------+------------+--------+-------+-----------+----------------+--------+----------------|
| 1/8        |     3.0 |            152 | 0@ 29' 07" |      4 |       |           | Pavement       |    144 |           7300 |
|------------+---------+----------------+------------+--------+-------+-----------+----------------+--------+----------------|
| Wk 1/1-1/7 |     18. |           1267 | 3@ 3' 27"  | #ERROR | 10.30 |      2.91 |                |    152 |         #ERROR |
|------------+---------+----------------+------------+--------+-------+-----------+----------------+--------+----------------|
#+TBLFM: $7=($3/($2*5280))*100*2;%.2f::@9$2=vsum(@2$2..@8$2)::@9$3=vsum(@2$3..@8$3)::@9$4=vsum(@2$4..@8$4)::$6='(if (zerop (length $2)) "" (/ (my/org-time-as-min-float $4) (string-to-number $2)));E %.2f::@>$9=vmean(@-7$0..@-1$0);%.0f::@>$1='(concat "Wk " @-7 "-" @-1)
#+TBLFM: @>$5='(my/org-sum-prod '(2 3) '(1 2));N
#+TBLFM: @>$5='(my/org-time-as-min-float-arr @-7$5);%.2f
#+TBLFM: @>$>='(org-sbe my-add (@-7$<<<<..@-1$<<<<))


#+name: my-add
#+begin_src emacs-lisp :var range=() :exports none :return
(let ((val 0)
      (maxiter (length range))
      (iter 0))
   (print val)
   (print maxiter)
   (while (< iter maxiter)
     (setq val (+ val (substring-no-properties (nth iter range))))
     (setq iter (+ iter 1)))
   val)
#end_src
