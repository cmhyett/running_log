# TODO plot pace on graph
# TODO fix effort calculation
# TODO allow easy aggregation of week/month/year data

[[./imgs/jan1.png]]

#+PLOT: set:"term pngcairo size 500,300" title:"Mileage" ind:1 deps:(2) type:2d with:histograms set:"yrange [0:8]" set:"xrange[-0.5:7.5]" file:"./imgs/jan1.png"
| Date         | Mileage | Elev gain | Time       | Effort |  Pace | Notes                                                                                                           | Grade (%) | Surface        | Avg Hr | Elevation (ft) |
| <4>          |     <3> |       <4> |            |    <1> |   <4> | <3>                                                                                                             |       <4> | <4>            |    <3> |            <4> |
|--------------+---------+-----------+------------+--------+-------+-----------------------------------------------------------------------------------------------------------------+-----------+----------------+--------+----------------|
| 1/1          |     3.0 |       237 | 0@ 32' 22" |      6 | 10.79 |                                                                                                                 |      2.99 | Trail          |    162 |           7300 |
| 1/2          |     2.0 |       136 | 0@ 18' 33" |      4 |  9.28 |                                                                                                                 |      2.58 | Pavement       |    152 |           7300 |
| 1/3          |         |           |            |        |  0.00 |                                                                                                                 |      0.00 |                |        |                |
| 1/4          |     5.0 |       492 | 0@ 53' 47" |      4 | 10.76 |                                                                                                                 |      3.73 | Trail          |    159 |           7100 |
| 1/5          |     3.0 |       132 | 0@ 29' 14" |      3 |  9.74 |                                                                                                                 |      1.67 | Pavement       |    145 |           7300 |
| 1/6          |         |           |            |        |  0.00 |                                                                                                                 |      0.00 |                |        |                |
| 1/7          |     5.0 |       270 | 0@ 49' 31" |      3 |  9.90 |                                                                                                                 |      2.05 | Pavement, snow |    143 |           7300 |
|--------------+---------+-----------+------------+--------+-------+-----------------------------------------------------------------------------------------------------------------+-----------+----------------+--------+----------------|
| 1/8          |     3.0 |       152 | 0@ 29' 07" |      4 |  9.71 |                                                                                                                 |      1.92 | Pavement       |    144 |           7300 |
| 1/9          |         |           |            |        |  0.00 |                                                                                                                 |      0.00 |                |        |                |
| 1/10         |     8.0 |      1780 | 1@ 43' 09" |      5 | 12.89 | "Bently" or survival run, went up pipeline just shy of valle de los posos. Gorgeous. Heavy snow after ~9000'.   |      8.43 | Trail, snow    |    152 |           8300 |
| 1/11         |     4.4 |        95 | 0@ 39' 58" |      7 |  9.08 | First tempo in years on tired legs. Idea was to over-stress the system with this and previous day's run to encourage adaptation. 7:30/mi for 20min. Very happy with the effort. |      0.82 | Track          |    154 |           7500 |
| 1/12         |         |           |            |        |  0.00 |                                                                                                                 |      0.00 |                |        |                |
| 1/13         |    2.05 |       145 | 0@ 20' 48" |      4 | 10.15 |                                                                                                                 |      2.68 | Heavy snow     |    146 |           7300 |
| 1/14         |     5.9 |       267 | 0@ 57' 16" |      3 |  9.71 | Knee pain ~4mi. Something about the gentle, monotonous downhill of the canyon rim trail always makes the knee flair up. Also skipped cross-training last 2 days. Taking 2 days off to rest the tendon(?) and crosstrain |      1.71 | Pavement, snow |    146 |           7300 |
|--------------+---------+-----------+------------+--------+-------+-----------------------------------------------------------------------------------------------------------------+-----------+----------------+--------+----------------|
| Wk 1/8-1/14  |   23.35 |      2439 | 4@ 10' 18" | #ERROR | 10.72 |                                                                                                                 |      3.96 |                |    148 |           7540 |
|--------------+---------+-----------+------------+--------+-------+-----------------------------------------------------------------------------------------------------------------+-----------+----------------+--------+----------------|
| 2/24         |       1 |           | 0@ 09' 52" |        |  9.87 |                                                                                                                 |      0.00 |                |    152 |                |
| 3/11         |       1 |           | 0@ 09' 21" |        |  9.35 |                                                                                                                 |      0.00 |                |    152 |                |
| 3/16         |       2 |           | 0@ 18' 37" |        |  9.31 |                                                                                                                 |      0.00 |                |    155 |                |
| 4/6          |       2 |           | 0@ 18' 08" |        |  9.07 |                                                                                                                 |      0.00 |                |    156 |                |
| 4/8          |       2 |           | 0@ 18' 44" |        |  9.37 |                                                                                                                 |      0.00 |                |    156 |                |
| 4/13         |       2 |           | 0@ 21' 22" |        | 10.68 |                                                                                                                 |      0.00 |                |    153 |                |
| 4/15         |       3 |           | 0@ 27' 08" |        |  9.04 |                                                                                                                 |      0.00 |                |    163 |                |
| 4/17         |       2 |           | 0@ 16' 35" |        |  8.29 |                                                                                                                 |      0.00 |                |    157 |                |
| 4/24         |    1.34 |           | 0@ 12' 53" |        |  9.61 |                                                                                                                 |      0.00 |                |    148 |                |
| 4/24         |       1 |           | 0@ 09' 38" |        |  9.63 |                                                                                                                 |      0.00 |                |    158 |                |
| 4/26         |       2 |           | 0@ 17' 52" |        |  8.93 |                                                                                                                 |      0.00 |                |    152 |                |
| 5/8          |    4.29 |           | 0@ 42' 08" |        |  9.82 |                                                                                                                 |      0.00 |                |    154 |                |
| 5/15         |    1.12 |           | 0@ 10' 37" |        |  9.48 |                                                                                                                 |      0.00 |                |    139 |                |
| 5/21         |       3 |           | 0@ 28' 32" |        |  9.51 |                                                                                                                 |      0.00 |                |    149 |                |
| 5/23         |    1.53 |           | 0@ 19' 15" |        | 12.58 |                                                                                                                 |      0.00 |                |    162 |                |
| 5/29         |     2.5 |           | 0@ 23' 33" |        |  9.42 |                                                                                                                 |      0.00 |                |    143 |                |
| 5/31         |    3.14 |           | 0@ 30' 17" |        |  9.64 |                                                                                                                 |      0.00 |                |    153 |                |
|--------------+---------+-----------+------------+--------+-------+-----------------------------------------------------------------------------------------------------------------+-----------+----------------+--------+----------------|
| 6/3          |       3 |           | 0@ 30' 29" |        | 10.16 |                                                                                                                 |      0.00 |                |    141 |                |
| 6/10         |     2.3 |           | 0@ 23' 44" |        | 10.32 |                                                                                                                 |      0.00 |                |    140 |                |
| 6/15         |     2.0 |           | 0@ 18' 34" |        |  9.28 |                                                                                                                 |      0.00 |                |    148 |                |
| 6/16         |       3 |           | 0@ 30' 32" |        | 10.18 |                                                                                                                 |      0.00 |                |    142 |                |
| 6/17         |         |           |            |        |  0.00 |                                                                                                                 |      0.00 |                |        |                |
| 6/18         |       3 |           | 0@ 27' 48" |        |  9.27 |                                                                                                                 |      0.00 |                |    154 |                |
| 6/19         |         |           |            |        |  0.00 |                                                                                                                 |      0.00 |                |        |                |
| 6/20         |         |           |            |        |  0.00 |                                                                                                                 |      0.00 |                |        |                |
| 6/21         |       3 |           | 0@ 28' 13" |        |  9.41 |                                                                                                                 |      0.00 |                |    153 |                |
| 6/22         |       3 |           | 0@ 26' 00" |        |  8.67 |                                                                                                                 |      0.00 |                |    150 |                |
|--------------+---------+-----------+------------+--------+-------+-----------------------------------------------------------------------------------------------------------------+-----------+----------------+--------+----------------|
| Wk 6/16-6/22 |      12 |         0 | 1@ 52' 33" |        |  0.00 |                                                                                                                 |      0.00 |                |    150 |      vmean([]) |
|--------------+---------+-----------+------------+--------+-------+-----------------------------------------------------------------------------------------------------------------+-----------+----------------+--------+----------------|
#+TBLFM: $8=($3/($2*5280))*100*2;%.2f::@>$2=vsum(@-7$2..@-1$2)::@>$3=vsum(@-7$3..@-1$3)::@>$4=vsum(@-7$4..@-1$4)::$6='(if (zerop (length $2)) "" (/ (my/org-time-as-min-float $4) (string-to-number $2)));E %.2f::@>$10=vmean(@-7$0..@-1$0);%.0f::@>$1='(concat "Wk " @-7 "-" @-1)::@>$>=vmean(@-7$>..@-1$>)
#+TBLFM: @>$5='(my/org-sum-prod '(2 3) '(1 2));N
#+TBLFM: @>$5='(my/org-time-as-min-float-arr @-7$5);%.2f
#+TBLFM: @>$>='(org-sbe my-add (@-7$<<<<..@-1$<<<<))


#+name: my-add
#+begin_src emacs-lisp :var range=() :exports none :return
(let ((val 0)
      (maxiter (length range))
      (iter 0))
   (print val)
   (print maxiter)
   (while (< iter maxiter)
     (setq val (+ val (substring-no-properties (nth iter range))))
     (setq iter (+ iter 1)))
   val)
#end_src
